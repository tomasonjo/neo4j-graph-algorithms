[[algorithms-balanced-triads]]
= The Balanced Triads algorithm

[abstract]
--
This section describes the Balanced Triads algorithm in the Neo4j Graph Algorithms library.
--

// tag::introduction[]
<intro text>
// end::introduction[]


[[algorithms-balanced-triads-context]]
== History and explanation

// tag::explanation[]

all the text

// end::explanation[]


[[algorithms-balanced-triads-usecase]]
== Use-cases - when to use the Balance Triads algorithm

// tag::use-case[]
* one
* two
* threee
// end::use-case[]


[[algorithms-balanced-triads-sample]]
== Balanced Triads algorithm sample

This sample will explain the Balanced Triads algorithm, using a simple graph:

image::balanced_triads.png[]

.The following will create a sample graph:
[source, cypher]
----
include::scripts/balanced-triads.cypher[tag=create-sample-graph]
----

.The following will return a stream of triples, with `nodeId` for each triangle:
[source, cypher]
----
include::scripts/balanced-triads.cypher[tag=stream-sample-graph]
----

// tag::stream-triples-result[]
.Results
[opts="header",cols="1,1,1"]
|===
| nodeA   | nodeB   | nodeC
| Will    | Michael | Chris
| Will    | Mark    | Michael
| Michael | Karin   | Chris
|===
// end::stream-triples-result[]

// tag::stream-graph-explanation[]
We can see that there are `KNOWS` triangles containing "Will, Michael, and Chris", "Will, Mark, and Michael", and "Michael, Karin, and Chris".
This means that everybody in the triangle knows each other.
// end::stream-graph-explanation[]

.The following will count the number of triangles that a node is member of, and write it back. It will return the total triangle count and average clustering coefficient of the given graph:
[source, cypher]
----
include::scripts/balanced-triads.cypher[tag=write-sample-graph]
----

// tag::write-sample-graph-result[]
.Results
[opts="header",cols="1,1,1"]
|===
| Name    | Triangles | Coefficient
| Karin   | 1         | 1
| Mark    | 1         | 1
| Chris   | 2         | 0.6666666666666666
| Will    | 2         | 0.6666666666666666
| Michael | 3         | 0.3
| Alice   | 0         | 0
|===
// end::write-sample-graph-result[]

// tag::write-sample-graph-explanation[]
We learn that Michael is part of the most triangles, but it's Karin and Mark who are the best at introducing their friends - all of the people who know them, know each other!
// end::write-sample-graph-explanation[]


[[algorithms-balanced-triads-example]]
== Example usage

In graph theory, a https://en.wikipedia.org/wiki/Clustering_coefficient[clustering coefficient] is a measure of the degree to which nodes in a graph tend to cluster together.
Evidence suggests that in most real-world networks, and in particular social networks, nodes tend to create tightly knit groups characterised by a relatively high density of ties; this likelihood tends to be greater than the average probability of a tie randomly established between two nodes.

We check if this holds true for Yelp's social network of friends:

[source, cypher]
----
include::scripts/triangle-count.cypher[tag=triangle-write-yelp]
----

Average clustering coefficient is 0.0523, which is really low for a social network.
This indicates that groups of friends are not tightly knit together, but rather sparse.
We can assume that users are not on Yelp for finding and creating friends, like Facebook for example, but rather something else, like finding good restaurant recommendations.

Local triangle count and clustering coefficient of nodes can be used as features in finding influencers in social networks.


[[algorithms-balanced-triads-syntax]]
== Syntax

.The following will count the number of triangles that a node is a member of, and return a stream with `nodeId` and `triangleCount`:
[source, cypher]
----
CALL algo.balancedTriads.stream(label:String, relationship:String, {concurrency:4})
YIELD nodeId, balanced, unbalanced
----

.Parameters
[opts="header",cols="1,1,1,1,4"]
|===
| Name         | Type   | Default        | Optional | Description
| label        | string | null           | yes      | The label to load from the graph. If null, load all nodes
| relationship | string | null           | yes      | The relationship-type to load from the graph. If null, load all relationships
| weightProperty | string  | null           | no      | The property name that contains weight. If null, treats the graph as unweighted. Must be numeric.
| concurrency  | int    | available CPUs | yes      | The number of concurrent threads
|===

.Results
[opts="header",cols="1,1,6"]
|===
| Name      | Type | Description
| nodeId    | int  | The ID of node
| balanced | int  | The number of triangles a node is member of
| unbalanced | int  | The number of triangles a node is member of
|===

.The following will count the number of triangles that a node is a member of, and write it back. It will return the total triangle count and average clustering coefficient of the given graph:
[source, cypher]
----
CALL algo.balancedTriads(label:String, relationship:String,
  {concurrency:4, write:true, weightProperty:'weight', balancedProperty:'balanced', unbalancedProperty:'unbalanced'})
YIELD loadMillis, computeMillis, writeMillis, nodeCount, balancedTriadCount, unbalancedTriadCount
----

.Parameters
[opts="header",cols="1,1,1,1,4"]
|===
| Name                          | Type    | Default        | Optional | Description
| label                         | string  | null           | yes      | The label to load from the graph. If null, load all nodes
| relationship                  | string  | null           | yes      | The relationship-type to load from the graph. If null, load all relationships
| concurrency                   | int     | available CPUs | yes      | The number of concurrent threads
| weightProperty                | string  | null           | no       | The property name that contains weight. If null, treats the graph as unweighted. Must be numeric.
| balancedProperty | string  | 'balanced'   | yes      | The property name written back to
| unbalancedProperty | string  | 'unbalanced'   | yes      | The property name written back to
| write                         | boolean | true           | yes      | Specifies if the result should be written back as a node property

|===

.Results
[opts="header",cols="1,1,6"]
|===
| Name                         | Type  | Description
| nodeCount                    | int   | The number of nodes considered
| loadMillis                   | int   | Milliseconds for loading data
| evalMillis                   | int   | Milliseconds for running the algorithm
| writeMillis                  | int   | Milliseconds for writing result data back
| balancedTriadCount           | int   | The number of triangles in the given graph
| unbalancedTriadCount         | int   | The average clustering coefficient of the given graph
|===


== Graph type support

The Balanced Triads algorithm support the following graph type:

* [x] undirected, weighted


ifndef::env-docs[]
== References

// tag::references[]
* a
* b
* c
// end::references[]
endif::env-docs[]
