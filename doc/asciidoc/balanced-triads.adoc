[[algorithms-balanced-triads]]
= The Balanced Triads algorithm

[abstract]
--
This section describes the Balanced Triads algorithm in the Neo4j Graph Algorithms library.
--

// tag::introduction[]
Balanced Triads algorithm is used to evaluate structural balance of the graph.

It is based on the https://en.wikipedia.org/wiki/Balance_theory[Balance Theory] proposed by Fritz Heider in 1958.
Unlike other algorithms where there are only positive relationships available, balance theory differentiates between positive and negative relationships.
Certain structures between individuals and objects are perceived as balanced whereas others are not.
In general balanced structures are preferred over imbalanced ones.

// end::introduction[]


[[algorithms-balanced-triads-context]]
== History and explanation

// tag::explanation[]

Balanced triads is an algorithm that counts the number of balanced and unbalanced triads a node is member of.
It uses https://en.wikipedia.org/wiki/Signed_graph[Signed graph] model to differentiate between positive and negative relationships using the sign of the weight.

Determining if the triad is balanced is simple math:

+ + + = Balanced 
- + - = Balanced 
- + + = Unbalanced 
- - - = Unbalanced

// end::explanation[]


[[algorithms-balanced-triads-usecase]]
== Use-cases - when to use the Balance Triads algorithm

// tag::use-case[]
* Balanced triads algorithm has been used to analyse structural balance of networks in the animal kingdom. Find this study in https://www.tau.ac.il/~geffene/PDFs/93-Anim_Behav_2013b.pdf[Structural balance in the social networks of a wild mammal].
* Balanced triads algorithm has been used to evaluate dynamics in the process of "healing" imbalanced triads and restoring structural balance in a social network. Find more details in https://www.maths.ed.ac.uk/~antal/Mypapers/friends05.pdf[Dynamics of social balance on networks].
* Balanced triads algorithm and balance theory allow us to better understand consumer to brand relationship and consumer behaviour as shown in the study of https://www2.bc.edu/arch-woodside/sep%2021heider%20balance%20theory.pdf[Updating Heiderâ€™s Balance Theory in Consumer Behaviour] by Woodside and Chabet.
// end::use-case[]


[[algorithms-balanced-triads-sample]]
== Balanced Triads algorithm sample

This sample will explain the Balanced Triads algorithm, using a simple graph:

image::balanced_triads.png[]

.The following will create a sample graph:
[source, cypher]
----
include::scripts/balanced-triads.cypher[tag=create-sample-graph]
----

.The following will count the number of balanced and unbalanced triads that a node is a member of, and return a stream with `nodeId`, `balanced` and `unbalanced`:
[source, cypher]
----
include::scripts/balanced-triads.cypher[tag=stream-sample-graph]
----

.The following will count the number of balanced and unbalanced triads that a node is member of, and write it back. It will return the total balanced triads and unbalanced triads count of the given graph:
[source, cypher]
----
include::scripts/balanced-triads.cypher[tag=write-sample-graph]
----

// tag::stream-sample-graph-result[]
.Results
[opts="header",cols="1,1,1"]
|===
| nodeId  | balanced | unbalanced
| Anna    | 3        | 3
| Matt    | 1        | 1
| Larry   | 1        | 1
| Stefan  | 1        | 1
| Sophia  | 1        | 1
| Dolores | 1        | 1
|===
// end::stream-sample-graph-result[]

// tag::stream-sample-graph-explanation[]
Anna is a member of six triads out of which three are balanced and three are unbalanced.
All others are each members of one balanced and one unbalanced triad or triangle.
// end::stream-sample-graph-explanation[]

[[algorithms-balanced-triads-example]]
== Example usage

[[algorithms-balanced-triads-syntax]]
== Syntax

.The following will count the number of balanced and unbalanced triads that a node is a member of, and return a stream with `nodeId`, `balanced` and 'unbalanced':
[source, cypher]
----
CALL algo.balancedTriads.stream(label:String, relationship:String, {concurrency:4})
YIELD nodeId, balanced, unbalanced
----

.Parameters
[opts="header",cols="1,1,1,1,4"]
|===
| Name           | Type   | Default        | Optional | Description
| label          | string | null           | yes      | The label to load from the graph. If null, load all nodes
| relationship   | string | null           | yes      | The relationship-type to load from the graph. If null, load all relationships
| weightProperty | string | null           | no       | The property name that contains weight. If weight is positive, algorithm treats the relationship as positive. With a negative weight, relationship is treated as negative. Must be numeric.
| concurrency    | int    | available CPUs | yes      | The number of concurrent threads
|===

.Results
[opts="header",cols="1,1,6"]
|===
| Name       | Type | Description
| nodeId     | int  | The ID of node
| balanced   | int  | The number of balanced triads a node is member of
| unbalanced | int  | The number of unbalanced a node is member of
|===

.The following will count the number of balanced and unbalanced triads that a node is member of, and write it back. It will return the total balanced triads and unbalanced triads count of the given graph:
[source, cypher]
----
CALL algo.balancedTriads(label:String, relationship:String,
  {concurrency:4, write:true, weightProperty:'weight', balancedProperty:'balanced', unbalancedProperty:'unbalanced'})
YIELD loadMillis, computeMillis, writeMillis, nodeCount, balancedTriadCount, unbalancedTriadCount
----

.Parameters
[opts="header",cols="1,1,1,1,4"]
|===
| Name                          | Type    | Default        | Optional | Description
| label                         | string  | null           | yes      | The label to load from the graph. If null, load all nodes
| relationship                  | string  | null           | yes      | The relationship-type to load from the graph. If null, load all relationships
| concurrency                   | int     | available CPUs | yes      | The number of concurrent threads
| weightProperty                | string  | null           | no       | The property name that contains weight. If weight is positive, algorithm treats the relationship as positive. With a negative weight, relationship is treated as negative. Must be numeric.
| balancedProperty              | string  | 'balanced'     | yes      | The property name written back to the count of balanced triads a node is member of
| unbalancedProperty            | string  | 'unbalanced'   | yes      | The property name written back to the count of unbalanced triads a node is member of
| write                         | boolean | true           | yes      | Specifies if the result should be written back as a node property

|===

.Results
[opts="header",cols="1,1,6"]
|===
| Name                         | Type  | Description
| nodeCount                    | int   | The number of nodes considered
| loadMillis                   | int   | Milliseconds for loading data
| evalMillis                   | int   | Milliseconds for running the algorithm
| writeMillis                  | int   | Milliseconds for writing result data back
| balancedTriadCount           | int   | The number of balanced triads in the given graph
| unbalancedTriadCount         | int   | The number of unbalanced triads in the given graph
|===


== Graph type support

The Balanced Triads algorithm support the following graph type:

* [x] undirected, weighted


ifndef::env-docs[]
== References

// tag::references[]
* [1] https://en.wikipedia.org/wiki/Balance_theory
* [2] https://en.wikipedia.org/wiki/Signed_graph
* [3] https://www.tau.ac.il/~geffene/PDFs/93-Anim_Behav_2013b.pdf
* [4] https://www.maths.ed.ac.uk/~antal/Mypapers/friends05.pdf
* [5] https://www2.bc.edu/arch-woodside/sep%2021heider%20balance%20theory.pdf
// end::references[]
endif::env-docs[]
